---
title: "Course Project 1"
author: "Hesham Elhalawani"
date: "June 9, 2017"
output: html_document
---

# Setting knitr options

```{r setup, echo = TRUE}

library(knitr)
base.dir <- "/Users/Lobna/Documents"
fig.path <- "/Users/Lobna/Documents/figure/"
opts_knit$set(base.dir = base.dir, self.contained=FALSE)
knitr::opts_chunk$set(cache = TRUE, echo = TRUE, message = FALSE, 
                      warning = FALSE, fig.path = fig.path, base.dir = base.dir) 
```

#Loading and preprocessing data


```{r, echo = TRUE}
if(!file.exists('activity.csv')){
    unzip('activity.zip')
}
activityData <- read.csv('activity.csv')
```

# Calculating mean total number of steps taken per day

```{r, echo = TRUE}
total.steps <- tapply(activityData$steps, activityData$date, FUN=sum, na.rm=TRUE)
hist(total.steps, xlab="total number of steps taken each day")
mean(total.steps, na.rm=TRUE)
median(total.steps, na.rm=TRUE)
```


# Calculating/Plotting Average daily activity pattern

## 1. Time series plot

```{r, echo = TRUE}
library(ggplot2)
averages <- aggregate(x=list(steps=activityData$steps), by=list(interval=activityData$interval),
                      FUN=mean, na.rm=TRUE)
ggplot(data=averages, aes(x=interval, y=steps)) + geom_line() + xlab("5-minute interval") +
    ylab("average number of steps taken")
```

## 2. Maximum number of steps

```{r, echo = TRUE}
averages[which.max(averages$steps),]
```


# Imputing missing values

## 1. Calculating and reporting the total number of missing values in the dataset

```{r, echo = TRUE}
missing <- is.na(activityData$steps)
table(missing)
```

## 2. Filling in all of the missing values in the dataset with the mean value of its corresponding 5-minute interval

```{r, echo = TRUE}
fill.value <- function(steps, interval) {
    filled <- NA
    if (!is.na(steps))
        filled <- c(steps)
    else
        filled <- (averages[averages$interval==interval, "steps"])
    return(filled)
}
```

## 3. Creating a new dataset with missing data filled in

```{r, echo = TRUE}
filled.activityData <- activityData
filled.activityData$steps <- mapply(fill.value, filled.activityData$steps, filled.activityData$interval)
```

## 4. Impact of imputing missing data

### a. Plotting a histogram of the total number of steps taken each day

```{r, echo = TRUE}
total.steps <- tapply(filled.activityData$steps, filled.activityData$date, FUN=sum)
hist(total.steps, xlab="total number of steps taken each day")
```

### b. Calculating and reporting mean and median
```{r, echo = TRUE}
mean(total.steps)
median(total.steps)
```

### c. Mean and median values differ from the estimates when missing values were not accounted for. Hence, an impact of imputing missing data on the estimates of the total daily number of steps can be concluded.

# Estimating the differences in activity patterns between weekdays and weekends

## 1. Subset the dataset into 2 levels (weekday vs weekend)

```{r, echo = TRUE}
weekday_vs_weekend <- function(date) {
    day <- weekdays(date)
    if (day %in% c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday"))
        return("weekday")
    else if (day %in% c("Saturday", "Sunday"))
        return("weekend")
    else
        stop("invalid date")
}
filled.activityData$date <- as.Date(filled.activityData$date)
filled.activityData$day <- sapply(filled.activityData$date, FUN=weekday_vs_weekend)
```

## 2. Creating time series plot

```{r, echo = TRUE}
averages <- aggregate(steps ~ interval + day, data=filled.activityData, mean)
ggplot(averages, aes(interval, steps)) + geom_line() + facet_grid(day ~ .) +
    xlab("5-minute interval") + ylab("Number of steps")
```

